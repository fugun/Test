<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title> apk更新</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="keywords" content="apk更新" />
    <meta name="description" content="apk更新" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Cache-Control" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <link href="../res/assets/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="../res/assets/font-awesome/css/font-awesome.css" rel="stylesheet" />
    <link rel="stylesheet" href="../res/assets/bootstrap-toggle-buttons/static/stylesheets/bootstrap-toggle-buttons.css" />
    <link href="../res/css/style.css" rel="stylesheet" />
    <link href="../res/css/chosen.css" rel="stylesheet" />
    <script type="text/javascript" src="../res/js/updateFile.js" ></script>
    <script src="../res/js/laydate/laydate.js"></script>
    <link href="../res/css/font-awesome.css" rel="stylesheet">
    <link rel="stylesheet" href="../res/css/glightbox.css">
</head>
<style type="text/css">
		
		#showui li{
			text-decoration: none;
			list-style: none;
			display: inline;
			
		}
		#showinput li{
			text-decoration: none;
			list-style: none;
			display: inline;
			
		}
		
	</style>
	<style type="text/css">
          /*  <style type="text/css"> */
            /* div{
                width: 250px;
                margin: 50px auto;
                overflow: hidden;
            } */
            #showinputs li img{
                width: 50%;
                cursor: pointer;
                transition: all 0.6s;/*图片放大过程的时间*/
            }
            #showinputs li img:hover{
                transform: scale(2);/*鼠标经过图片放大的倍数*/
                
            }
			
        </style> 
<body class="fixed-top">
    <div class="container-fluid container-fluid-back">
        
        <div id="page-wraper">
        </div>
        <!-- huadongm-->
        <div class="Main">
            <div id="divMainTab" class="MainTab">
                <ul class="huadm" id = "ua">
                   <!--  <li id="li_1" class="selected" onClick="changeTab('1')" >查询</li> -->
                    <li id="li_1" class="selected" ></li>
                </ul>
            </div>
            <input type="hidden" id="id" name="id" value=""/>
            
            <div id="div1" style="display :block" class="divContent">
                <div class="" id="sms_channel_list">
                    
                    <div class="widget-body">
                            <!-- BEGIN FORM-->
                            <div class="form-actions actionsbao"> 
                             <div class="upimg">   
                                 <div >	
                             			<span style= "color:red;font-size:15px" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                                        <select class="span6 chzn-select" style=" width:130px;" id="type" data-placeholder="" tabindex="1" >
                                       		
                                       		 <option value="1" selected="selected">强制更新</option>
                                       		  <option value="0" selected="selected">建议更新</option>
                                       		 
                                    	</select>
                                </div>   
                                <div>  
                                 	<span style= "color:red;font-size:15px" >&nbsp;&nbsp;&nbsp;当前版本号：&nbsp;&nbsp;&nbsp;</span> 
                                	<input type="text" id="version"   style="width:70px;color:red;text-align:center;border:0; " readonly="readonly"/>
                                </div>
                                 <div>                         	                               			                               		
                               		 <span style= "color:red;font-size:15px" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;版本号：&nbsp;&nbsp;&nbsp;</span>
                               		<input type="text" id="versionUpdate"   style="width:70px;text-align:center;"/>                            
                                 </div>
                                  <div>                         	                               			                               		
                               		 <span style= "color:red;font-size:15px" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;版本更新时间：&nbsp;&nbsp;&nbsp;</span>
                               		<input type="text" id="lastModiftyTime"   style="width:130px;color:red;text-align:center;border:0; " readonly="readonly"/>                            
                                 </div>
                                 <div id = "fileXZ"> 
                                 	
                                 </div>
                                 
                               </div> 						                                          
                            </div>
                        	
                            <div class="form-actions actionsbao">
                            	<div class="upimg">
										<input type="file" id="upgteimg" value="" multiple />										
										<button class="btn yans1" id="submit" style ="background:#4A4A4A;" >开始上传</button>
										<button  id = "end" class="btn yans1" style ="background:#4A4A4A;">清除文件</button>
										
								</div>
								<input type="hidden" id="img_url" name="img" value=""/>
                           	   
									<ul id="showui">
									</ul>
									
									<div id="showinput">
										<ul id="showinputs">
									</ul>																		
								    </div>																
                            </div>
                            <div class="form-actions actionsbao">
                                <button type="submit" onclick="saveEdit()" class="btn yans1" style ="background:#4A4A4A;">保存</button>
                                <button type="button" class="btn" id = 'ends' onclick="emptyEdit()">取消</button>
                            </div>
                            <!-- END FORM-->
                        </div>
                    </div>
                
                <!-- END BASIC PORTLET-->
            </div>
        </div>
        <!-- huadongm-->
        <!-- 结束:列表-->
        <!-- 开始:通道接入类型-->
        <div id="page-wraper">
        </div>
        <!-- 结束:通道接入类型-->
    </div>
    <script src="../res/js/jquery-1.8.2.min.js"></script>
    <script type="text/javascript" src="../res/js/jquery.nicescroll.js"></script>
    <script type="text/javascript" src="../res/js/chosen.jquery.min.js"></script>
    <script type="text/javascript" src="../res/assets/bootstrap-toggle-buttons/static/js/jquery.toggle.buttons.js"></script>
    <script src="../res/js/common-scripts.js"></script>
    <script src="../res/js/form-component.js"></script>
    <script src="../res/js/layer.min.js" type="text/javascript"></script>
   <!--  <script src="res/js/onion_news_comment3.js" type="text/javascript"></script> -->
    <script language="javascript" type="text/javascript">
        //<![CDATA[
        $(document).ready(function() {
        	findAppVersion();
        });
        
       
        function findAppVersion() {
            var sms_load = layer.load("正在努力加载中..");
            var url = "find/apk"; 
            $.post(
                url, {                	           	                   	                   
                },
                function(data) {
                    layer.close(sms_load);
                    if(data.code ==200){
                    	 var apks = data.data; 
                    	 console.log(apks);
                         $.each(apks, function(i, apk) { 
                        	 console.log("apk"+apk.id);
                         		$("#id").val(apk.id);
 	                            $("#version").val(apk.version);   
 	                            $("#lastModiftyTime").val(getLocalTime(apk.lastModiftyTime));
 	                            //var c = '<a href=http://47.103.11.55'+apk.appUrl +' target="_blank" title="">&nbsp;apk文件下载:<span style= "color:red;font-size:15px">http://47.107.52.22'+apk.appUrl+'</span></a>';
 	                            var c = '<a href=http://admin.beiyongkj.com'+apk.appUrl +' target="_blank" title="">&nbsp;apk文件下载:<span style= "color:red;font-size:15px">http://admin.beiyongkj.com'+apk.appUrl+'</span></a>';
 	                            $("#fileXZ").html(c);  
 	                            $("#type").val(apk.type);
 	                           $(".chzn-select").trigger("liszt:updated");
                         });
                    }else{
                    	 layer.alert("载入失败!请刷新重试", 3, !1);
                    }
                 
                }, "json"
            );
        }

        //取消
        function emptyEdit(){
        	//end();              	             
            // $("#Description").val("");
             $("#img_url").val("");
             $("#versionUpdate").val("");	
            
             $("#showui").each(function(){//寻找#test下面所有的div
                 /* var a=$(this).text(); *///获取#test下面每个div的文字
                 $(this).empty();//清空#test下面所有的内容
                /*  $(this).text(a); *///把每个div的内容赋给清除内容以后的div */
                 });
             $("#lastModiftyTime").val("");           
 			$(".chzn-select").trigger("liszt:updated");
         
        }
        
        function saveEdit() {
        	var sms_load = layer.load("保存中..");
        	var type = $("#type").val();
            var versionUpdate = $("#versionUpdate").val();
            var id = $("#id").val();
            var imgUrl = $("#img_url").val();
            if (versionUpdate.length < 1) {
                layer.alert("请输入版本号!\n Error:版本号不能为空!", 3, !1);
                layer.close(sms_load);
                return false;
            }                
            if (imgUrl.length < 1) {
                layer.alert("请上传.apk文件!", 3, !1);
                layer.close(sms_load);
                return false;
            }  
            var save_task_url = "update/apk";
            var data ={
            		version:versionUpdate,
	        		id:id,
	        		appUrl:imgUrl,
	        		type,type
	            };        
	        $.ajax({
	    		url:save_task_url,
	    		data:data,
	    		type:'post',
	    		dataType:'json',
	    		success: function(result){
	    			
	    			
	    			layer.close(sms_load);
                    if(result.code ==200){
                    	layer.alert("保存成功!", 1, !1);
                        emptyEdit();
                        findAppVersion(); 
                         
                    }else{
                    	 layer.alert(result.msg, 3, !1);
                    }
	    			
	    		},
	    		error: function(e){
	    			alert("通信失败!");
	    			
	    		}
	        });
        }

        function getLocalTime(date) {     
        	var date = new Date(date);
        	Y = date.getFullYear() + '-';
        	M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';
        	D = date.getDate() + ' ';
        	h = date.getHours() + ':';
        	m = date.getMinutes() + ':';
        	s = date.getSeconds();  
        	return(Y+M+D+h+m+s);     
        	}
        function getLocalTimes(date) {     
        	var date = new Date(date);
        	Y = date.getFullYear() + '-';
        	M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';
        	D = date.getDate() + ' ';        	
        	return(Y+M+D);     
        	}
        //]]>
    </script>
</body>

</html>

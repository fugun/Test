/* fancynode |  | vserion 0.0.1*/
function searchWord(a,b){var c=splitWordsToKey(a);if(0==c.length)return[];for(var d=[],e=0;e<c.length;e++){var f=matchesSuccessiveSubString(c[e],b);d=d.concat(f)}d=concatMatchs(d),d=d?d:[];for(var g=!1,e=0;e<d.length;e++){var h=d[e];if(h.end-h.start>=2){g=!0;break}}return g||1==a.length?d:[]}function splitWordsToKey(a){function b(a){return 97<=a.charCodeAt(0)&&a.charCodeAt(0)<=122}function c(a){return 65<=a.charCodeAt(0)&&a.charCodeAt(0)<=90}for(var d=[],e="",f=!1,g=0;g<a.length;g++){var h=a.charAt(g);c(h)?(e&&!f&&(d.push(e),e=""),e+=h,f=!0):b(h)?(e+=h,f=!1):(e&&(d.push(e),e="")," "!=h&&"\t"!=h&&"\n"!=h&&"\r"!=h&&"\f"!=h&&d.push(h),f=!1)}return e&&(d.push(e),e=""),d}function concatMatchs(a){function b(a,b){return a.start>=b.start&&a.start<=b.end||a.end>=b.start&&a.end<=b.end}function c(a,b){var c=Math.min(a.start,b.start),d=Math.max(a.end,b.end);return{start:c,end:d}}function d(a,d){for(var e=!1,f=0;f<d.length;f++)if(b(a,d[f])){d[f]=c(a,d[f]),e=!0;break}e||d.push(a)}for(var e=[],f=0;f<a.length;f++)d(a[f],e);return e.sort(function(a,b){return a.start-b.start}),e}function matchesSuccessiveSubString(a,b){if(!a)return[];a=a.toLowerCase(),b=b.toLowerCase();var c=b.split(a),d=[],e=0,f=a.length;if(c)for(var g=0;g<c.length-1;g++)e+=c[g].length,d.push({start:e,end:e+f}),e+=f;return d}function checkInTag(a,b){if(a<0||a>=b.length)return!1;var c=b.indexOf("<",a),d=b.indexOf(">",a);return c!=-1&&d!=-1?!(c<d):d!=-1&&a==-1}function initDocs(a){for(var b=0;b<a.length;b++){var c=a[b],d=JSON.parse(c);formatDoc(d),docs.push(d)}docs.sort(function(a,b){return a.index-b.index}),navigationContainer=$(".navigation-container"),contentRootContainer=$(".content-container.level-1"),contentSearchContainer=$(".content-container.search"),catalogContainerCage=$(".catalog-container-cage"),catalogContainer=$(".catalog-container"),initCatalog(docs,1,catalogContainer),initSearch($("#search-input"),$("#search-button")),initCurrentPage(),window.addEventListener("popstate",function(a){initCurrentPage()},!1),updateCatalogSize()}function formatDoc(a){if("children"in a)for(var b=0;b<a.children.length;b++){var c=a.children[b];c.parent=a,"key"in c||(c.key=b+""),formatDoc(c)}}function initCatalog(a,b,c){var d=$("<ul></ul>").addClass("level-"+b);c.append(d);for(var e=0;e<a.length;e++){var f=a[e],g=f.title,h=f.key,i=$("<li></li>").attr("key",h).addClass("close");d.append(i),f.hide&&i.addClass("hide");var j=$("<a></a>").text(g);i.append(j),i.click(function(a){a.stopPropagation(),catalogClick_handler(a.currentTarget)});var k=f.children;if(k){var l=!0;if(f.isContent&&!f.catalog&&(l=!1),l){var m=$("<i></i>").addClass("cross");j.append(m),initCatalog(k,b+1,i)}}}}function findCatalogItem(a,b){function c(a,b){for(var d=$(b).children(),e=0;e<d.length;e++)if($(d[e]).attr("key")==a)return d[e];for(var e=0;e<d.length;e++){var f=c(a,d[e]);if(f)return f}return null}var d=null;d=b?catalogContainer:contentRootContainer;for(var e=0;e<a.length&&(d=c(a[e],d),d);e++);return d}function catalogClick_handler(a){var b=getKeysByElement(a),c=getCanSelectedByKeys(b);if(c){var d="/pxcook/docs?ids=";d+=b.join("/");var e=window.location.origin+d;if(window.location.href!=e)if(history&&history.pushState){var f={};history.pushState(f,null,d)}else window.location.href=e}switchCatalogItem(a,c),c&&showSpecifedPage(b)}function switchCatalogItem(a,b){$(a).find("li").length>0&&($(a).hasClass("close")?($(a).removeClass("close"),$(a).addClass("open"),$(a).children("a").children(".cross").addClass("open"),ensureCatalogSelectedVisible(a)):(b&&$(a).hasClass("active")||!b)&&($(a).removeClass("open"),$(a).children("a").children(".cross").removeClass("open"),$(a).addClass("close"))),b&&($(".catalog-container li").removeClass("active"),$(a).addClass("active"))}function getKeysByElement(a){for(var b=[],c=a;;){var d="";if($(c).length>0&&(d=$(c)[0].tagName.toLowerCase()),"li"!=d&&"ul"!=d)break;"li"==d&&b.push($(c).attr("key")),c=$(c).parent()}return b.reverse(),b}function getKeysByData(a){for(var b=[],c=a;c;)"key"in c&&b.push(c.key),c=c.parent;return b.reverse(),b}function getDatasForContents(a){for(var b=[],c=[],d={children:docs},e=0;e<a.length&&(d=findDataByKey(a[e],d),d);e++)if(b.push(d),d.isContent){for(var f=e+1;f<a.length&&(d=findDataByKey(a[f],d),d);f++)c.push(a[f]);break}return{datas:b,leftKeys:c}}function getCanSelectedByKeys(a){var b=getDataByKeys(a);return!!b&&(!!b.isContent||!b.children)}function getDataByKeys(a){for(var b={children:docs},c=0;c<a.length;c++)if(b=findDataByKey(a[c],b),!b)return null;return b}function findDataByKey(a,b){if(!b.children)return null;for(var c=0;c<b.children.length;c++)if(b.children[c].key==a)return b.children[c];return null}function initSearch(a,b){function c(a){urlValue=encodeURIComponent(a);var b="/pxcook/docs?search=";b+=urlValue;var c=window.location.origin+b;if(window.location.href!=c)if(history&&history.pushState){var d={};history.pushState(d,null,b)}else window.location.href=c;showSearchPage(a)}$(a).keydown(function(b){13==b.keyCode&&c($(a).val())}),$(b).click(function(b){c($(a).val())})}function getRequest(){var a=location.search,b=new Object;if(a.indexOf("?")!=-1){var c=a.substr(1);strs=c.split("&");for(var d=0;d<strs.length;d++)b[strs[d].split("=")[0]]=decodeURIComponent(strs[d].split("=")[1])}return b}function initCurrentPage(){var a=getRequest(),b=a.ids,c=a.search;if(c)return void showSearchPage(c);var d=[];if(b&&(d=b.split("/")),$(".catalog-container li").removeClass("active"),d.length>0){for(var e=[],f=null,g=0;g<d.length;g++){e.push(d[g]);var h=null;try{h=findCatalogItem(e,!0)}catch(i){}if(h&&(f=h),!h)break;$(h).find("li").length>0&&($(h).removeClass("close"),$(h).addClass("open"),$(h).children("a").children(".cross").addClass("open"))}if(f){var j=getKeysByElement(f);getCanSelectedByKeys(j)?($(f).addClass("active"),showSpecifedPage(d)):showDefaultPage()}else showDefaultPage()}else showDefaultPage()}function showDefaultPage(){if(0!=docs.length){for(var a=[],b=docs[0];b&&(a.push(b.key),!b.isContent)&&b.children;){var c=b.children;if(!(c.length>0))break;b=c[0]}if(0!=a.length){$(".catalog-container li").removeClass("active");for(var d=[],e=null,f=0;f<a.length;f++){d.push(a[f]);var g=null;try{g=findCatalogItem(d,!0)}catch(h){}if(g&&(e=g),!g)break;$(g).find("li").length>0&&f<a.length-1&&($(g).removeClass("close"),$(g).addClass("open"),$(g).children("a").children(".cross").addClass("open"))}if(e){var i=getKeysByElement(e);getCanSelectedByKeys(i)&&($(e).addClass("active"),showSpecifedPage(a))}}}}function showSpecifedPage(a){function b(a){var b=getKeysByData(a),c=b.join("/");currentVideoData=a;var d=videoMap[c];if(d)currentVideoElement=d.video,currentVideoContainer=d.container;else{$(".page-product-docs.pxcook .videoOverlay").empty();var e='<div class="pxcook-video-container"><div class="pxcook-video-title">'+a.title+'</div><video class="pxcook-video" controls="controls" controlsList="nodownload noremote foobar" \t\tposter="'+a.firstShot+'" width="'+a.targetWidth+'" height="'+Math.round(a.targetWidth/a.sourceWidth*a.sourceHeight)+'">\t<source src="'+a.mp4+'" type="video/mp4" />\t<source src="'+a.webm+'" type="video/webm" />\t<source src="'+a.ogv+'" type="video/ogg" />\t<img src="'+a.firstShot+'" width="'+a.targetWidth+'" height="'+Math.round(a.targetWidth/a.sourceWidth*a.sourceHeight)+'" title="'+a.title+'" /></video></div>';currentVideoContainer=$(e),$(".page-product-docs.pxcook .videoOverlay").append(currentVideoContainer),currentVideoElement=$(".page-product-docs.pxcook .videoOverlay .pxcook-video")[0],currentVideoContainer=$(".page-product-docs.pxcook .videoOverlay .pxcook-video-container")[0],videoMap[c]={video:currentVideoElement,container:currentVideoContainer}}if($(".page-product-docs.pxcook .videoOverlay").append(currentVideoContainer),$(".page-product-docs.pxcook .videoOverlay").css({display:"inherit"}),$("body").css({overflow:"hidden"}),$(currentVideoContainer).css({display:"inherit"}),$(currentVideoContainer).css({"margin-top":"-"+Math.round((a.targetWidth/a.sourceWidth*a.sourceHeight+30+20)/2)+"px"}),$(currentVideoContainer).css({"margin-left":"-"+Math.round(a.targetWidth/2)+"px"}),currentVideoElement){var f=currentVideoElement.play();void 0!==f&&f.then(function(){}).catch(function(a){console.log(a)})}var g="/pxcook/docs?ids="+c,h=window.location.origin+g;if(window.location.href!=h&&history&&history.pushState){var i={};history.pushState(i,null,g)}}function c(a,c){$(a).click(function(){b(c)})}function d(a,b,e){var f=a.subTitle?a.subTitle:a.title;if(a.videos){var g=a.children?a.children:[];$(e).addClass("video-container");for(var h=0;h<g.length;h++){var i=g[h],j=$("<div>").addClass("video-item-container");$(e).append(j);var k=$("<div>").addClass("video-screen-shot-container");$(j).append(k);var l=$('<img style="width:100%;" src="'+i.screenShot+'"/>').addClass("video-screen-shot");$(k).append(l);var m=$("<div>").addClass("video-screen-shot-mask");$(k).append(m);var n=$('<img src="'+imagePath+'images/pxcook/docs/play-icon.svg"/>').addClass("play-icon");$(k).append(n);var o=$("<div>"+i.title+"</div>").addClass("video-title");$(j).append(o),c(j,i)}}else{var p=$("<div>"+f+"</div>").addClass("title");a.key&&p.attr("key",a.key),$(e).append(p),1==b&&$(e).append('<div class="line"></div>');var q=a.contents?a.contents:[];if(q.length>0){var r=$("<div></div>").addClass("content");$(e).append(r),$(r).append(q.join(""))}var g=a.children?a.children:[];if(g.length>0){var s=$("<div></div>").addClass("content-container");$(s).addClass("level-"+(b+1)),$(e).append(s);for(var h=0;h<g.length;h++)d(g[h],b+1,s)}}}function e(){var a=findCatalogItem(h,!1);if(a){var b=a,c=Math.round($(b).offset().top);$("html,body").animate({scrollTop:c},{duration:300,step:function(){updateCatalogSize(),ensureCatalogSelectedVisible()},complete:function(){updateCatalogSize(),ensureCatalogSelectedVisible()}})}}$("#search-input").val(""),$(contentSearchContainer).css({display:"none"}),$(contentRootContainer).css({display:""});for(var f=getDatasForContents(a),g=f.datas,h=f.leftKeys,i=[],j=0;j<g.length-1;j++){var k=g[j],l=k.title;i.push(l)}$(navigationContainer).empty(),$(navigationContainer).append(i.join('<span class="dividing-line">/</span>')),addVideoOverlayClicked||(addVideoOverlayClicked=!0,$(".page-product-docs.pxcook .videoOverlay").click(function(a){if(a.target==$(".page-product-docs.pxcook .videoOverlay")[0]&&($("body").css({overflow:"auto"}),$(".page-product-docs.pxcook .videoOverlay").empty(),$(".page-product-docs.pxcook .videoOverlay").css({display:"none"}),currentVideoContainer&&($(currentVideoContainer).css({display:"none"}),currentVideoContainer=null,currentVideoElement=null),$(".page-product-docs.pxcook .videoOverlay").empty(),currentVideoData)){var b=getKeysByData(currentVideoData);b=b.slice(0,b.length-1);var c=b.join("/"),d="/pxcook/docs?ids="+c,e=window.location.origin+d;if(window.location.href!=e&&history&&history.pushState){var f={};history.pushState(f,null,d)}currentVideoData=null}}));var m=g[g.length-1];if(lastContentData!=m&&(lastContentData=m,$(contentRootContainer).empty(),d(m,1,contentRootContainer)),m&&m.videos&&h.length>0){var n=getDataByKeys(a);n&&n.mp4&&b(n)}else h.length>0?"complete"==document.readyState?setTimeout(e,100):window.onload=function(){setTimeout(e,100),window.onload=null}:(updateContentPosition(),updateCatalogSize(),ensureCatalogSelectedVisible())}function showSearchPage(a){function b(a,c){if(!c.hide){if(c.title&&c.contents&&c.contents.length>0){for(var d=c.subTitle?c.subTitle:c.title,e=c.contents?c.contents:[],f=[],g=0;g<e.length;g++){var i=e[g];i=i.replace(/\<img.*?\>/g,""),i=i.replace(/\<ul\>/g,""),i=i.replace(/\<\/ul\>/g,""),i=i.replace(/\<\/ul\>/g,""),i=i.replace(/\<div.*?\>/g,""),i=i.replace(/\<\/div\>/g,""),i=i.replace(/\<li.*?\>/g,""),i=i.replace(/\<\/li\>/g,""),i=i.replace(/\<p>/g,""),i=i.replace(/\<br.*?\>/g,""),i=i.replace(/\<p\>/g,""),i=i.replace(/\<\/p\>/g,""),i=$.trim(i),i&&f.push(i)}var j=f.join(""),k=searchWord(a,d),l=searchWord(a,j);(k&&k.length>0||l&&l.length>0)&&h.push({keys:getKeysByData(c),title:d,content:j,titleResult:k,contentResult:l})}var m=c.children;if(m)for(var g=0;g<m.length;g++)b(a,m[g])}}function c(a,b){var c=b.indexOf("</",a);if(c!=-1){var d=b.indexOf(">",c);if(d!=-1)return d}return b.length}function d(a,b){return b=b.slice(0,a),b=b.replace(/\<.*?\>/g,""),b.length}function e(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];checkInTag(e.start,b)||checkInTag(e.end,b)||c.push(e)}return c}function f(a,b){if(0==a.length)return{offset:0,content:b};var e=a[0],f=0,g=e.start;if(g=d(g,b),g>180)for(var h=0;h<b.length;h++){var i=b.charAt(h);if("<"==i){var j=c(h,b);if(!(j<g)){f=h;break}h=j}if(g-h<=50){f=h;break}}return 0==f?{offset:0,content:b}:(">"==b.charAt(f)&&f++,{offset:f-3,content:"..."+b.slice(f)})}function g(a,b){for(var c,d=[],e=0,f=0;f<b.length;f++)c=b[f],c.end!==c.start&&(e<c.start&&(d.push("<span>"),d.push(a.substring(e,c.start)),d.push("</span>"),e=c.end),d.push('<span class="highlight">'),d.push(a.substring(c.start,c.end)),d.push("</span>"),e=c.end);return e<a.length&&(d.push("<span>"),d.push(a.substring(e)),d.push("</span>")),d.join("")}a=$.trim(a),$("#search-input").val(a),$(navigationContainer).empty(),$(contentSearchContainer).empty(),$(navigationContainer).append('搜索 “<span class="search-key-word">'+a+"</span>” 的结果为："),$(contentSearchContainer).css({display:""}),$(contentRootContainer).css({display:"none"});var h=[];b(a,{children:docs}),h.sort(function(a,b){function c(a){for(var b=0,c=0;c<a.length;c++){var d=a[c].end-a[c].start;d>b&&(b=d)}return b}var d=Math.max(c(a.titleResult),c(a.contentResult)),e=Math.max(c(b.titleResult),c(b.contentResult));if(d!=e)return e-d;var f=a.titleResult.length+a.contentResult.length,g=b.titleResult.length+b.contentResult.length;return g-f});for(var i=0;i<h.length;i++){var j=h[i];j.titleResult=e(j.titleResult,j.title),j.contentResult=e(j.contentResult,j.content);var k=f(j.contentResult,j.content),l=j.titleResult,m=j.contentResult;j.content=k.content;for(var n=0;n<l.length;n++)l[n].start-=k.offset,l[n].end-=k.offset;for(var n=0;n<m.length;n++)m[n].start-=k.offset,m[n].end-=k.offset}if(0==h.length){var o=$("<div>抱歉，我们找不到任何结果。请尝试其他搜索词。</div>").addClass("none-result");$(contentSearchContainer).append(o)}else for(var i=0;i<h.length;i++){var j=h[i],p=j.keys,q=j.title,r=j.content,l=j.titleResult,m=j.contentResult,s=g(q,l),t=g(r,m),u=$("<div></div>").addClass("search-result-item");$(contentSearchContainer).append(u);var v=$("<div>"+s+"</div>").addClass("search-title");v.attr("keys",p.join("/")),u.append(v);var w=$("<div>"+t+"</div>").addClass("search-content");u.append(w),$(v).click(function(a){var b=$(a.currentTarget).attr("keys");searchClick_handler(b)}),$(contentSearchContainer).append("<div class='line'></div>")}updateContentPosition(),updateCatalogSize()}function searchClick_handler(a){var b=a.split("/"),c="/pxcook/docs?ids=";c+=b.join("/");var d=window.location.origin+c;if(window.location.href!=d)if(history&&history.pushState){var e={};history.pushState(e,null,c)}else window.location.href=d;initCurrentPage()}function updateCatalogSize(){if($(".page-product-docs.pxcook").length){var a=20;if($(window).scrollTop()>$(catalogContainerCage).offset().top-a){$(catalogContainer).css({position:"fixed"}),$(catalogContainer).css({top:a+"px"});var b=$(catalogContainerCage).outerHeight()+$(catalogContainerCage).offset().top-$(window).scrollTop()-a,c=$(window).height()-a-a,d=Math.min(b,c);$(catalogContainer).css({height:d+"px"})}else $(catalogContainer).css({position:"absolute"}),$(catalogContainer).css({top:"0px"}),$(catalogContainer).css({height:"100%"})}}function ensureCatalogSelectedVisible(a){if(!a){var b=$(".catalog-container li.active");if(0==b.length)return;a=b}var c=$(a).offset().top-$(".catalog-container ul").offset().top;if($(".catalog-container").scrollTop()>c)$(".catalog-container").scrollTop(c);else if($(".catalog-container").scrollTop()+$(".catalog-container").outerHeight()<c+$(a).outerHeight()){var d=c,e=c+$(a).outerHeight()-$(".catalog-container").outerHeight(),f=Math.min(d,e);$(".catalog-container").scrollTop(f)}}function updateContentPosition(){$(window).scrollTop()>$(".right-container").offset().top&&$("html,body").scrollTop($(".right-container").offset().top)}var script=document.getElementsByTagName("script");script=script[script.length-1];var imagePath=script.getAttribute("imagePath"),docs=[],navigationContainer=null,catalogContainer=null,catalogContainerCage=null,contentRootContainer=null,contentSearchContainer=null,lastContentData=null,addVideoOverlayClicked=!1,currentVideoElement=null,currentVideoContainer=null,currentVideoData=null,videoMap={};$(window).scroll(function(){updateCatalogSize()}),$(window).resize(function(){updateCatalogSize()}),$(document).ready(function(){updateCatalogSize()});